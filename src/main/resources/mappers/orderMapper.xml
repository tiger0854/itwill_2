<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<!--   CREATE TABLE `springdb`.`prod` ( -->
<!--   `wo_code` VARCHAR(30) NOT NULL, -->
<!--   `so_code` VARCHAR(45) NULL, -->
<!--   `employee_id` INT NULL, -->
<!--   `factory_code` VARCHAR(45) NULL, -->
<!--   `line_code` VARCHAR(45) NULL, -->
<!--   `item_code` VARCHAR(45) NULL, -->
<!--   `oQTY` INT NULL, -->
<!--   `pQTY` INT NULL, -->
<!--   `wo_status` VARCHAR(45) NULL, -->
<!--   `wo_date` VARCHAR(45) NULL, -->
<!--   `remark` VARCHAR(45) NULL, -->
<!--   PRIMARY KEY (`wo_code`)); -->
  
<!--        <td>작업지시 번호</td> -->
<!--       <td><input type="text" name="wo_code"></td> -->
<!--     </tr> -->
<!--     <tr> -->
<!--       <td>수주번호</td> -->
<!--       <td><input type="text" name="so_code"></td> -->
<!--     </tr> -->
<!--     <tr> -->
<!--       <td>수주수량</td> -->
<!--       <td><input type="text" name="sQTY"></td> -->
<!--     </tr> -->
<!--     <tr> -->
<!--       <td>작업지시자</td> -->
<!--       <td><input type="text" name="employee_id"></td> -->
<!--     </tr> -->
<!--     <tr> -->
<!--       <td>납품예정일</td> -->
<!--       <td><input type="date" name="delivery_date"></td> -->
<!--     </tr> -->
<!--     <tr> -->
<!--       <td>라인코드</td> -->
<!--       <td><input type="text" name="line_code"></td> -->
<!--     </tr> -->
<!--     <tr> -->
<!--       <td>품목코드</td> -->
<!--       <td><input type="text" name="item_code"></td> -->
<!--     </tr> -->
<!--     <tr> -->
<!--       <td>지시일자</td> -->
<!--       <td><input type="date" name="wo_date"></td> -->
<!--     </tr> -->
<!--     <tr> -->
<!--       <td>지시수량</td> -->
<!--       <td><input type="text" name="oQTY"></td> -->
<!--     </tr> -->
<!--     <tr> -->
<!--       <td>생산수량</td> -->
<!--       <td><input type="text" name="pQTY"></td> -->
<!--     </tr> -->
  
  <mapper namespace="com.ddosirak.mapper.OrderMapper">
  	
<!--   			  INSERT INTO prod -->
<!-- 		  (wo_code, so_code, sQTY, employee_id, delivery_date, line_code, item_code, wo_date, oQTY, pQTY) -->
<!-- 		  VALUES ( -->
<!-- 		    #{wo_code}, #{so_code}, #{sQTY}, #{employee_id}, #{delivery_date}, #{line_code}, #{item_code}, -->
<!-- 		    CURDATE(), #{oQTY}, #{pQTY} -->
<!-- 		  ) -->
		  
  	<!-- 작업지시 등록 -->
	<insert id="insertOrder">
	  <selectKey keyProperty="wo_code" resultType="String" order="BEFORE">
	    SELECT CONCAT('WO', DATE_FORMAT(NOW(), '%Y%m%d'),
	      (SELECT count(wo_code) + 1 FROM prod)) AS wo_code
	  </selectKey>
		  INSERT INTO prod
		  (wo_code, so_code, sQTY, employee_id, delivery_date, line_code, item_code, wo_date, oQTY, pQTY)
		  VALUES (
		    #{wo_code}, #{so_code}, #{sQTY}, #{employee_id}, #{delivery_date}, #{line_code}, #{item_code},
		    CURDATE(), #{oQTY}, #{pQTY}
		  )
	</insert>
	
	
  	<!-- 작업지시 등록 -->
  	
  	<!-- 작업지시 목록 출력-->
  	<select id="proOrderList" resultType="com.ddosirak.domain.ProOrderVO">
		SELECT * FROM prod
  	</select>
  	
  	<!-- 작업지시 정보 -->
  	<select id="getProOrder" resultType="com.ddosirak.domain.ProOrderVO">
		SELECT * FROM prod WHERE wo_code=#{wo_code}
  	</select>

  	
  	<!-- 작업지시  수정 -->
  	<update id="editProOrder">
  		UPDATE prod SET so_code=#{so_code}, sQTY=#{sQTY},employee_id=#{employee_id},delivery_date=#{delivery_date},line_code=#{line_code},item_code=#{item_code}, 
  		oQTY=#{oQTY},pQTY=#{pQTY},wo_status=#{wo_status}
  		WHERE wo_code=#{wo_code}
  	</update>
  	<!-- 작업지시  수정 -->
  	
  	<!-- 작업지시 삭제 -->
  	<delete id="deleteProOrder">
  		delete from prod where wo_code=#{wo_code}
  	</delete>
  	<!-- 작업지시 삭제 -->
  
  </mapper>